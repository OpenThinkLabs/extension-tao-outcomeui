function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}(function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/format",["lodash"],factory):(global=global||self,global["core/format"]=factory(global._))})(this,function(_){'use strict';function format(message){var replacements=Array.prototype.slice.call(arguments,1);return _.reduce(message.match(pattern),function(acc,match,index){var replacement="";if(void 0!==replacements[index]){switch(match){case"%d":replacement=+replacements[index];break;case"%j":try{replacement=JSON.stringify(replacements[index]).replace(/"/g,"")}catch(e){}break;default:replacement=replacements[index];}message=message.replace(match,replacement)}return message},message)}_=_&&_.hasOwnProperty("default")?_["default"]:_;var pattern=/(%[sdj])/g;return format}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("core/promise",factory):(global=global||self,global["core/promise"]=factory())}(this,function(){'use strict';return Promise}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/format"),require("core/promise")):"function"==typeof define&&define.amd?define("core/logger/api",["lodash","core/format","core/promise"],factory):(global=global||self,global["core/logger/api"]=factory(global._,global["core/format"],global["core/promise"]))}(this,function(_,format,Promise){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,format=format&&format.hasOwnProperty("default")?format["default"]:format,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise;var defaultLevel="info",levels={fatal:60,error:50,warn:40,info:30,debug:20,trace:10},logQueue=[],getLevel=function(level){return"undefined"==typeof level||_.isString(level)&&!_.has(levels,level)?defaultLevel:_.isNumber(level)?_.findKey(levels,function(l){return l===level})||defaultLevel:level},getLevelNum=function(level){return _.isString(level)&&_.has(levels,level)?levels[level]:_.isNumber(level)&&_.contains(levels,level)?level:levels[defaultLevel]},checkMinLevel=function(minLevel,level){return getLevelNum(level)>=getLevelNum(minLevel)},loggerFactory=function loggerFactory(name,minLevel,fields){var baseRecord,logger;if(!_.isString(name)||_.isEmpty(name))throw new TypeError("A logger needs a name");return _.isPlainObject(minLevel)&&"undefined"==typeof field&&(fields=minLevel,minLevel=defaultLevel),baseRecord=_.defaults(fields||{},{name:name,pid:1,hostname:navigator.userAgent}),logger={log:function(level,recordFields,message){var record,err,rest=[],time=new Date().toISOString();if(!1!==loggerFactory.providers&&checkMinLevel(minLevel||defaultLevel,level))return _.isString(recordFields)||recordFields instanceof Error?(message=recordFields,recordFields={},rest=[].slice.call(arguments,2)):rest=[].slice.call(arguments,3),record={level:getLevel(level),v:0,time:time},checkMinLevel(levels.error,level)||message instanceof Error?(message instanceof Error?err=message:(message=_.isObject(message)?JSON.stringify(message):message,err=new Error(message)),record.msg=err.message,record.err=err):record.msg=format.apply(null,[message].concat(rest)),_.merge(record,baseRecord,recordFields),logQueue.push(record),loggerFactory.flush(),this},level:function level(value){return"undefined"==typeof value?getLevel(minLevel):(minLevel=getLevelNum(value),this)},child:function(childFields){return loggerFactory(name,minLevel,_.defaults(childFields,baseRecord))}},_.reduce(levels,function(target,level,levelName){return target[levelName]=_.partial(logger.log,level),target},logger)};return loggerFactory.levels=levels,loggerFactory.providers=!1,loggerFactory.load=function(providerConfigs){var self=this,modules=[];return this.providers=[],new Promise(function(resolve,reject){_.forEach(providerConfigs,function(providerConfig,providerName){modules.push(providerName)}),require(modules,function(){var loadedProviders=[].slice.call(arguments);_.forEach(loadedProviders,function(provider,moduleKey){try{self.register(provider,providerConfigs[modules[moduleKey]])}catch(err){reject(err)}}),self.flush(),resolve()},reject)})},loggerFactory.register=function(provider,providerConfig){if(!_.isPlainObject(provider)||!_.isFunction(provider.log))throw new TypeError("A log provider is an object with a log method");provider.checkMinLevel=checkMinLevel,_.isFunction(provider.setConfig)&&provider.setConfig(providerConfig),this.providers=this.providers||[],this.providers.push(provider)},loggerFactory.flush=function(){_.isArray(this.providers)&&0<this.providers.length&&(_.forEach(logQueue,function(message){_.forEach(loggerFactory.providers,function(provider){provider.log.call(provider,message)})}),logQueue=[])},loggerFactory.setDefaultLevel=function(level){return defaultLevel=getLevel(level),defaultLevel},loggerFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("module"),require("core/logger/api")):"function"==typeof define&&define.amd?define("core/logger",["lodash","module","core/logger/api"],factory):(global=global||self,global["core/logger"]=factory(global._,global.module,global["core/logger/api"]))}(this,function(_,module,loggerFactory){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,module=module&&module.hasOwnProperty("default")?module["default"]:module,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var defaultConfig={level:loggerFactory.levels.warn,loggers:{"core/logger/console":{level:"warn"}}},config=_.defaults(module.config()||{},defaultConfig),logger=loggerFactory("core/logger");return loggerFactory.setDefaultLevel(config.level),loggerFactory.load(config.loggers),window.onerror=function(msg,url,line,col){logger.error("Caught[via window.onerror]: '"+msg+"' from "+url+":"+line+":"+col)},window.setTaoLogLevel=function(level){return loggerFactory.setDefaultLevel(level)},loggerFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("context")):"function"==typeof define&&define.amd?define("util/url",["lodash","context"],factory):(global=global||self,global["util/url"]=factory(global._,global.context))}(this,function(_,context){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,context=context&&context.hasOwnProperty("default")?context["default"]:context;var parsers={absolute:/^(?:[a-z]+:)?\/\//i,base64:/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/,query:/(?:^|&)([^&=]*)=?([^&]*)/g,url:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/};return{parse:function(url){var matches,keys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","queryString","hash"],i=keys.length,parsed=Object.create({toString:function toString(){return this.source}});if(parsed.base64=parsers.base64.test(url),parsed.base64)parsed.source=url;else{for(matches=parsers.url.exec(url);i--;)parsed[keys[i]]=matches[i]||"";parsed.query={},parsed.queryString.replace(parsers.query,function($0,$1,$2){$1&&(parsed.query[$1]=$2)})}return parsed},isAbsolute:function(url){return"object"===_typeof(url)&&url.hasOwnProperty("source")?url.source!==url.relative:"string"==typeof url?parsers.absolute.test(url):void 0},isRelative:function(url){var absolute=this.isAbsolute(url);if("boolean"==typeof absolute)return!absolute},isBase64:function(url){return"object"===_typeof(url)&&url.hasOwnProperty("source")?url.base64:"string"==typeof url?parsers.base64.test(url):void 0},encodeAsXmlAttr:function(uri){return /[<>&']+/.test(uri)?encodeURIComponent(uri):uri},build:function(path,params){var url,hasQueryString,queryString="";return path&&(_.isString(path)&&(url=path),_.isArray(path)&&(url="",_.forEach(path,function(chunk){url+=/\/$/.test(url)&&/^\//.test(chunk)?chunk.substr(1):""===url||/\/$/.test(url)||/^\//.test(chunk)?chunk:"/"+chunk})),_.isPlainObject(params)&&(hasQueryString=-1<url.indexOf("?"),queryString=_.reduce(params,function(acc,value,key){return(!_.isEmpty(acc)||hasQueryString)&&(acc+="&"),"object"!==_typeof(value)||_.isArray(value)?acc+=encodeURIComponent(key)+"="+encodeURIComponent(value):_.forOwn(value,function(parameterValue,parameterName){acc+=encodeURIComponent(key)+"["+encodeURIComponent(parameterName)+"]="+encodeURIComponent(parameterValue)+"&"}),acc},queryString),!_.isEmpty(queryString)&&(!hasQueryString&&(url+="?"),url+=queryString))),url},route:function(action,controller,extension,params,rootUrl){var routeParts=[extension,controller,action];if(_.some(routeParts,function(value){return _.isEmpty(value)||!_.isString(value)}))throw new TypeError("All parts are required to build an URL");return rootUrl=rootUrl||context&&context.root_url,this.build([rootUrl].concat(routeParts),params)}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/uuid"),require("core/logger")):"function"==typeof define&&define.amd?define("core/eventifier",["lodash","core/promise","lib/uuid","core/logger"],factory):(global=global||self,global["core/eventifier"]=factory(global._,global["core/promise"],global["lib/uuid"],global["core/logger"]))}(this,function(_,Promise,uuid,loggerFactory){'use strict';function getEventNames(eventNames){return!_.isString(eventNames)||_.isEmpty(eventNames)?[]:_(eventNames.split(/\s/g)).compact().uniq().value()}function getName(eventName){return-1<eventName.indexOf(".")?eventName.substr(0,eventName.indexOf(".")):eventName}function getNamespace(eventName){return-1<eventName.indexOf(".")?eventName.substr(eventName.indexOf(".")+1):"@"}function getHandlerObject(){return{before:[],between:[],after:[]}}function eventifier(target){var targetName,logger,stoppedEvents,eventHandlers={},getHandlers=function(eventName,type){var name=getName(eventName),ns=getNamespace(eventName);return type=type||"between",eventHandlers[ns]=eventHandlers[ns]||{},eventHandlers[ns][name]=eventHandlers[ns][name]||getHandlerObject(),eventHandlers[ns][name][type]},eventApi={on:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName).push(handler)}),this},off:function(eventNames){return _.forEach(getEventNames(eventNames),function(eventName){var offNamespaces,name=getName(eventName),ns=getNamespace(eventName);ns&&!name?"*"===ns?(offNamespaces={},offNamespaces["@"]=eventHandlers["@"],eventHandlers=offNamespaces):eventHandlers[ns]={}:_.forEach(eventHandlers,function(nsHandlers,namespace){nsHandlers[name]&&("@"===ns||ns===namespace)&&(nsHandlers[name]=getHandlerObject())})}),this},removeAllListeners:function(){return eventHandlers={},this},trigger:function(eventNames){function triggerAllHandlers(allHandlers,name,ns){var event={name:name,namespace:ns};allHandlers.before.length?triggerBefore(allHandlers.before,event).then(function(){triggerBetween(allHandlers,event)}).catch(function(err){logHandlerStop("before",event,err)}):triggerBetween(allHandlers,event)}function triggerBefore(handlers,event){var pHandlers,beforeArgs=args.slice();return beforeArgs.unshift(event),pHandlers=handlers.map(function(handler){var value=!shouldStop(event.name)&&handler.apply(self,beforeArgs);return!1===value?Promise.reject():value}),Promise.all(pHandlers)}function triggerBetween(allHandlers,event){shouldStop(event.name)?logHandlerStop("before",event):triggerHandlers(allHandlers.between,event).then(function(){triggerAfter(allHandlers.after,event)}).catch(function(err){logHandlerStop("on",event,err)})}function triggerAfter(handlers,event){shouldStop(event.name)?logHandlerStop("on",event):triggerHandlers(handlers,event).then(function(){shouldStop(event.name)&&logHandlerStop("after",event)}).catch(function(err){logHandlerStop("after",event,err)})}function triggerHandlers(handlers,event){var pHandlers;return pHandlers=handlers.map(function(handler){return shouldStop(event.name)?Promise.reject():handler.apply(self,args)}),Promise.all(pHandlers)}function logHandlerStop(stoppedIn,event,err){err instanceof Error&&logger.error(err),logger.trace({err:err,event:event.name,stoppedIn:stoppedIn},event.name+" handlers stopped")}function shouldStop(name){return stoppedEvents[name]}var self=this,args=[].slice.call(arguments,1);return stoppedEvents={},_.forEach(getEventNames(eventNames),function(eventName){var ns=getNamespace(eventName),name=getName(eventName),mergedHandlers=_(eventHandlers).filter(function(nsHandlers,namespace){return nsHandlers[name]&&("@"===ns||ns===namespace||"*"===namespace)}).reduce(function(acc,nsHandlers){return acc.before=acc.before.concat(nsHandlers[name].before),acc.between=acc.between.concat(nsHandlers[name].between),acc.after=acc.after.concat(nsHandlers[name].after),acc},getHandlerObject());logger.trace({event:eventName,args:args},"trigger %s",eventName),mergedHandlers&&triggerAllHandlers(mergedHandlers,name,ns)}),this},before:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"before").push(handler)}),this},after:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"after").push(handler)}),this},stopEvent:function(name){_.isString(name)&&!_.isEmpty(name.trim())&&(stoppedEvents[name.trim()]=!0)},spread:function(destination,eventNames){var self=this;return destination&&_.isFunction(destination.trigger)&&(_.isString(eventNames)&&(eventNames=getEventNames(eventNames)),_.forEach(eventNames,function(eventName){self.on(eventName,function(){var args=[eventName].concat([].slice.call(arguments));destination.trigger.apply(destination,args)})})),this}};return target=target||{},targetName=target.name||target.id||target.serial||uuid(6),logger=eventifierLogger.child({target:targetName}),_(eventApi).functions().forEach(function(method){_.isFunction(target[method])&&eventifierLogger.warn("The target object has already a method named "+method,target),target[method]=function(){var args=[].slice.call(arguments);return eventApi[method].apply(target,args)}}),target}_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var eventifierLogger=loggerFactory("core/eventifier");return eventifier}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/regexEscape",factory):(global=global||self,global["util/regexEscape"]=factory())}(this,function(){'use strict';return function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("util/regexEscape")):"function"==typeof define&&define.amd?define("util/wrapLongWords",["util/regexEscape"],factory):(global=global||self,global["util/wrapLongWords"]=factory(global["util/regexEscape"]))}(this,function(regexEscape){'use strict';function wrapLongWords(str,threshold){str=str.toString().replace(/([\w])</g,"$1 <");for(var cut,chunkExp=new RegExp(".{1,"+threshold+"}","g"),longWords=str.match(new RegExp("[\\S]{"+threshold+",}","g"))||[],i=longWords.length;i--;)cut=getCutTerm(longWords[i],chunkExp),str=str.replace(new RegExp(regexEscape(longWords[i]),"g"),cut);return str}regexEscape=regexEscape&&regexEscape.hasOwnProperty("default")?regexEscape["default"]:regexEscape;var getCutTerm=function(longWord,chunkExp){for(var cutTerms=longWord.match(chunkExp),i=cutTerms.length,oldFirst="",newFirst="",offenders=[".",":",";"];i--;)newFirst=cutTerms[i].charAt(0),-1<offenders.indexOf(newFirst)&&(cutTerms[i]=cutTerms[i].substr(1)),-1<offenders.indexOf(oldFirst)&&(cutTerms[i]+=oldFirst),oldFirst=newFirst;return cutTerms.join(" ")};return wrapLongWords}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/encode",factory):(global=global||self,global["util/encode"]=factory())}(this,function(){'use strict';var _reQuot=/"/g,_reApos=/'/g,encodeHTML=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML};return{html:encodeHTML,attribute:function(html){return encodeHTML(html).replace(_reQuot,"&quot;").replace(_reApos,"&apos;")},encodeBase64:function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},decodeBase64:function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/eventifier")):"function"==typeof define&&define.amd?define("core/polling",["lodash","core/promise","core/eventifier"],factory):(global=global||self,global["core/polling"]=factory(global._,global["core/promise"],global["core/eventifier"]))}(this,function(_,Promise,eventifier){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier;var pollingFactory=function(config){var timer,promise,interval,max,iter,action,context,autoStart,_Mathabs=Math.abs,state={},startTimer=function(){timer=setTimeout(iteration,interval),state.stopped=!1,state.pending=!0},stopTimer=function(){clearTimeout(timer),timer=null,state.stopped=!0,state.pending=!1},iteration=function(){return max&&iter>=max?void polling.stop():void(iter=(iter||0)+1,state.processing=!0,state.pending=!1,polling.trigger("call"),action.call(context,polling),!promise&&!state.stopped&&(state.processing=!1,startTimer()))},polling={async:function(){var resolver={};return promise=new Promise(function(resolve,reject){resolver.resolve=resolve,resolver.reject=reject}),promise.then(function(){promise=null,state.processing=!1,state.stopped||startTimer(),polling.trigger("resolved")}).catch(function(){promise=null,state.processing=!1,polling.stop(),polling.trigger("rejected")}),polling.trigger("async",resolver),resolver},next:function(){var _next;return(state.stopped&&(iter=0),stopTimer(),max&&iter>=max)?this:(state.stopped=!1,promise?(_next=this.next.bind(this),promise.then(_next).catch(_next)):(this.trigger("next"),iteration()),this)},start:function(){return timer||(iter=0,startTimer(),this.trigger("start")),this},stop:function(){return stopTimer(),this.trigger("stop"),this},setInterval:function(value){return interval=_Mathabs(parseInt(value,10)||60000),this.trigger("setinterval",interval),this},getInterval:function(){return interval},setAction:function(fn){return action=fn,this.trigger("setaction",action),this},getAction:function(){return action},setContext:function(ctx){return context=ctx||this,this.trigger("setcontext",ctx),this},getContext:function(){return context},setMax:function(value){return max=_Mathabs(parseInt(value,10)||0),this},getMax:function(){return max},getIteration:function(){return iter||0},is:function(stateName){return!!state[stateName]}};return eventifier(polling),interval=60000,context=polling,action=null,state.stopped=!0,autoStart=!1,iter=0,_.isFunction(config)&&(polling.setAction(config),config=null),_.isObject(config)&&(polling.setAction(config.action),polling.setInterval(config.interval||arguments[1]),polling.setContext(config.context),polling.setMax(config.max),autoStart=!!config.autoStart),autoStart&&polling.start(),polling};return pollingFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/eventifier"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/promiseQueue",["lodash","core/promise","core/eventifier","lib/uuid"],factory):(global=global||self,global["core/promiseQueue"]=factory(global._,global["core/promise"],global["core/eventifier"],global["lib/uuid"]))}(this,function(_,Promise,eventifier,uuid){'use strict';return _=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,function(){var queue={},getId=function getId(){var id="promise-"+uuid(6);return"undefined"==typeof queue[id]?id:getId()};return{add:function(promise){return queue[getId()]=promise,this},getValues:function(){return _.values(queue)},clear:function(){return queue={},this},serie:function(promiseFn){var id=getId(),currentQueue=this.getValues(),emitter=eventifier();return queue[id]=new Promise(function(resolve){emitter.on("fulfilled",resolve)}),Promise.all(currentQueue).then(function(){if(_.isFunction(promiseFn))return promiseFn()}).then(function(data){return emitter.trigger("fulfilled"),delete queue[id],data}).catch(function(err){throw queue={},err})}}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/promiseQueue"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/store/localstorage",["lodash","core/promise","core/promiseQueue","lib/uuid"],factory):(global=global||self,global["core/store/localstorage"]=factory(global._,global["core/promise"],global["core/promiseQueue"],global["lib/uuid"]))}(this,function(_,Promise,promiseQueue,uuid){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue["default"]:promiseQueue,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid;var storage=window.localStorage,knownStoresName="index",idStoreName="id",writingQueue=promiseQueue(),setEntry=function(storeName,key,value){return new Promise(function(resolve,reject){try{storage.setItem("tao-store-"+storeName+"."+key,JSON.stringify(value)),resolve(!0)}catch(ex){reject(ex)}})},getEntry=function(storeName,key){return new Promise(function(resolve,reject){var value;try{value=storage.getItem("tao-store-"+storeName+"."+key),null===value?resolve():resolve(JSON.parse(value))}catch(ex){reject(ex)}})},getKnownStores=function(){return getEntry(knownStoresName,"stores")},registerStore=function(storeName){return getKnownStores().then(function(stores){return stores=stores||{},stores[storeName]={name:storeName,lastOpen:Date.now()},setEntry(knownStoresName,"stores",stores)})},unregisterStore=function(storeName){return getKnownStores().then(function(stores){return stores=stores||{},delete stores[storeName],setEntry(knownStoresName,"stores",stores)})},localStorageBackend=function(storeName){var name,registered=!1,openStore=function(){return registered?Promise.resolve():registerStore(storeName).then(function(){registered=!0})};if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return name="tao-store-"+storeName+".",{getItem:function(key){return writingQueue.serie(function(){return openStore().then(function(){return getEntry(storeName,key)})})},setItem:function(key,value){return writingQueue.serie(function(){return openStore().then(function(){return setEntry(storeName,key,value)})})},removeItem:function(key){return writingQueue.serie(function(){return openStore().then(function(){return storage.removeItem(name+key),!0})})},getItems:function(){var keyPattern=new RegExp("^"+name);return writingQueue.serie(function(){return openStore().then(function(){return _(storage).map(function(entry,index){return storage.key(index)}).filter(function(key){return keyPattern.test(key)}).reduce(function(acc,key){var value,exposedKey=key.replace(name,"");try{value=storage.getItem(key),null!==value&&(acc[exposedKey]=JSON.parse(value))}catch(ex){acc[exposedKey]=null}return acc},{})})})},clear:function(){var keyPattern=new RegExp("^"+name);return writingQueue.serie(function(){return openStore().then(function(){return _(storage).map(function(entry,index){return storage.key(index)}).filter(function(key){return keyPattern.test(key)}).forEach(function(key){storage.removeItem(key)}),!0})})},removeStore:function(){return this.clear().then(function(){return unregisterStore(storeName)})}}};return localStorageBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),getKnownStores().then(function(stores){var removing=_(stores).filter(function(store,storeName){return!validate||validate(storeName,store)}).map(function(store){return store&&store.name?localStorageBackend(store.name).removeStore():Promise.resolve()}).value();return Promise.all(removing)})},localStorageBackend.getAll=function(validate){return getKnownStores().then(function(stores){return _(stores).filter(function(store,storeName){return!validate||validate(storeName,store)}).map(function(store){return store.name}).value()})},localStorageBackend.getStoreIdentifier=function(){var idStore=localStorageBackend(idStoreName);return idStore.getItem(idStoreName).then(function(id){return _.isEmpty(id)?(id=uuid(),idStore.setItem(idStoreName,id).then(function(){return id})):id})},localStorageBackend}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/store/idbstore"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/store/indexeddb",["lodash","core/promise","lib/store/idbstore","lib/uuid"],factory):(global=global||self,global["core/store/indexeddb"]=factory(global._,global["core/promise"],global["lib/store/idbstore"],global["lib/uuid"]))}(this,function(_,Promise,IDBStore,uuid){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,IDBStore=IDBStore&&IDBStore.hasOwnProperty("default")?IDBStore["default"]:IDBStore,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid;var knownStores,idStoreName="id",isIndexedDB2="getAll"in IDBObjectStore.prototype,openStore=function(storeName){return new Promise(function(resolve,reject){var store=new IDBStore({dbVersion:1,storeName:storeName,storePrefix:"tao-store-",keyPath:"key",autoIncrement:!0,onStoreReady:function(){store.db.onversionchange=function(e){e&&e.newVersion||store.db.close()},resolve(store)},onError:reject})})},setEntry=function(store,key,value){return new Promise(function(resolve,reject){store.put({key:key,value:value},function(returnKey){resolve(returnKey===key)},reject)})},getEntry=function(store,key){return new Promise(function(resolve,reject){store.get(key,function(entry){return entry&&"undefined"!=typeof entry.value?void resolve(entry.value):resolve(entry)},reject)})},getEntries=function(store){return new Promise(function(resolve,reject){var success=function(entries){return _.isArray(entries)?void resolve(_.reduce(entries,function(acc,entry){return entry.key&&entry.value&&(acc[entry.key]=entry.value),acc},{})):resolve({})};store.getAll(success,reject)})},removeEntry=function(store,key){return new Promise(function(resolve,reject){store.remove(key,function(result){resolve(!1!==result)},reject)})},getKnownStores=function(){return knownStores||(knownStores=openStore("index")),knownStores},registerStore=function(storeName){return getKnownStores().then(function(store){return setEntry(store,storeName,{name:storeName,lastOpen:Date.now()})})},unregisterStore=function(storeName){return getKnownStores().then(function(store){return removeEntry(store,storeName)})},deleteStore=function(store,storeName){return new Promise(function(resolve,reject){var success=function(){unregisterStore(storeName).then(function(){resolve(!0)}).catch(reject)};isIndexedDB2?store.deleteDatabase(success,reject):store.clear(success,reject)})},indexDbBackend=function(storeName){var innerStore,writePromise,getStore=function(){return innerStore||(innerStore=openStore(storeName).then(function(store){return registerStore(storeName).then(function(){return Promise.resolve(store)})})),innerStore},ensureSerie=function(getWritingPromise){return writePromise?new Promise(function(resolve,reject){var runWrite=function(){var p=getWritingPromise();writePromise=p,p.then(resolve).catch(reject)};writePromise.then(runWrite).catch(runWrite)}):(writePromise=getWritingPromise(),writePromise)};if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return{getItem:function(key){return ensureSerie(function(){return getStore().then(function(store){return getEntry(store,key)})})},setItem:function(key,value){return ensureSerie(function(){return getStore().then(function(store){return setEntry(store,key,value)})})},removeItem:function(key){return ensureSerie(function(){return getStore().then(function(store){return removeEntry(store,key)})})},getItems:function(){return ensureSerie(function(){return getStore().then(function(store){return getEntries(store)})})},clear:function(){return ensureSerie(function(){return getStore().then(function(store){return new Promise(function(resolve,reject){store.clear(function(){resolve(!0)},reject)})})})},removeStore:function(){return ensureSerie(function(){return getStore().then(function(store){return deleteStore(store,storeName)})})}}};return indexDbBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),getKnownStores().then(function(store){return new Promise(function(resolve,reject){function cleanUp(entries){var all=[];_.forEach(entries,function(entry){var storeName=entry&&entry.key;storeName&&all.push(openStore(storeName).then(function(storeToRemove){if(!validate||validate(storeName,entry.value))return deleteStore(storeToRemove,storeName)}))}),Promise.all(all).then(resolve).catch(reject)}store.getAll(cleanUp,reject)})})},indexDbBackend.getAll=function(validate){return _.isFunction(validate)||(validate=function(){return!0}),getKnownStores().then(function(store){return new Promise(function(resolve,reject){store.getAll(function(entries){var storeNames=_(entries).filter(function(entry){return entry&&entry.key&&validate(entry.key,entry.value)}).map(function(entry){return entry.key}).value();return resolve(storeNames)},reject)})})},indexDbBackend.getStoreIdentifier=function(){return openStore(idStoreName).then(function(store){return getEntry(store,idStoreName).then(function(id){return _.isEmpty(id)?(id=uuid(),setEntry(store,idStoreName,id).then(function(){return id})):id})})},indexDbBackend}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/store/memory",["lodash","core/promise","lib/uuid"],factory):(global=global||self,global["core/store/memory"]=factory(global._,global["core/promise"],global["lib/uuid"]))}(this,function(_,Promise,uuid){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid;var idStore,memoryStore={},memoryStorageBackend=function(storeName){if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return memoryStore[storeName]=memoryStore[storeName]||{},{getItem:function(key){return _.isPlainObject(memoryStore[storeName])?Promise.resolve(memoryStore[storeName][key]):Promise.resolve()},setItem:function(key,value){return _.isPlainObject(memoryStore[storeName])||(memoryStore[storeName]={}),memoryStore[storeName][key]=value,Promise.resolve(!0)},removeItem:function(key){return memoryStore[storeName]=_.omit(memoryStore[storeName],key),Promise.resolve("undefined"==typeof memoryStore[storeName][key])},getItems:function(){return Promise.resolve(memoryStore[storeName])},clear:function(){return memoryStore[storeName]={},Promise.resolve(!0)},removeStore:function(){return memoryStore=_.omit(memoryStore,storeName),Promise.resolve("undefined"==typeof memoryStore[storeName])}}};return memoryStorageBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),memoryStore=_.omit(memoryStore,function(store,storeName){return!validate||validate(storeName)}),Promise.resolve(!0)},memoryStorageBackend.getAll=function(validate){var storeNames=[];return _.isFunction(validate)||(validate=null),storeNames=_(memoryStore).map(function(store,storeName){return storeName}).filter(function(storeName){return!validate||validate(storeName)}).value(),Promise.resolve(storeNames)},memoryStorageBackend.getStoreIdentifier=function(){return _.isEmpty(idStore)&&(idStore=uuid()),Promise.resolve(idStore)},memoryStorageBackend}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("moment"),require("module"),require("core/logger"),require("core/promise"),require("core/store/localstorage"),require("core/store/indexeddb"),require("core/store/memory")):"function"==typeof define&&define.amd?define("core/store",["lodash","moment","module","core/logger","core/promise","core/store/localstorage","core/store/indexeddb","core/store/memory"],factory):(global=global||self,global["core/store"]=factory(global._,global.moment,global.module,global["core/logger"],global["core/promise"],global["core/store/localstorage"],global["core/store/indexeddb"],global["core/store/memory"]))}(this,function(_,moment,module,loggerFactory,Promise,localStorageBackend,indexedDBBackend,memoryBackend){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,moment=moment&&moment.hasOwnProperty("default")?moment["default"]:moment,module=module&&module.hasOwnProperty("default")?module["default"]:module,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,localStorageBackend=localStorageBackend&&localStorageBackend.hasOwnProperty("default")?localStorageBackend["default"]:localStorageBackend,indexedDBBackend=indexedDBBackend&&indexedDBBackend.hasOwnProperty("default")?indexedDBBackend["default"]:indexedDBBackend,memoryBackend=memoryBackend&&memoryBackend.hasOwnProperty("default")?memoryBackend["default"]:memoryBackend;var store,supportsIndexedDB=!1,dectectionDone=!1,quotaChecked=!1,backendApi=["removeAll","getAll","getStoreIdentifier"],storeApi=["getItem","setItem","removeItem","getItems","clear","removeStore"],logger=loggerFactory("core/store"),config=_.defaults(module.config()||{},{lowSpaceRatio:80,invalidation:{staled:"P2W",oldster:"P2M"}}),isIndexDBSupported=function(){return dectectionDone?Promise.resolve(supportsIndexedDB):new Promise(function(resolve){var test,indexedDB,done=function(result){return supportsIndexedDB=!!result,dectectionDone=!0,resolve(supportsIndexedDB)};try{if(indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,!indexedDB)return done(!1);test=indexedDB.open("__feature_test",1),test.onsuccess=function(){if(test.result)return test.result.close(),done(!0)},test.onerror=function(e){return e.preventDefault(),done(!1),!1}}catch(err){done(!1)}})},checkQuotas=function(){!quotaChecked&&"storage"in window.navigator&&window.navigator.storage.estimate&&window.navigator.storage.estimate().then(function(estimate){var usedRatio=0;_.isNumber(estimate.usage)&&_.isNumber(estimate.quota)&&0<estimate.quota&&(usedRatio=estimate.usage/estimate.quota,usedRatio>config.lowSpaceRatio?(logger.warn("The browser storage is getting low "+usedRatio.toFixed(2)+"% used",estimate),logger.warn("We will attempt to clean oldster databases in persistent backends"),store.cleanUpSpace(config.invalidation.oldster,[],localStorageBackend),isIndexDBSupported&&store.cleanUpSpace(config.invalidation.oldster,[],indexedDBBackend)):logger.debug("Browser storage estimate : "+usedRatio.toFixed(2)+"% used",estimate))}).catch(function(err){logger.warn("Unable to retrieve quotas : "+err.message)}),quotaChecked=!0},isBackendApiValid=function(backend){return _.all(backendApi,function(method){return _.isFunction(backend[method])})},isStorageApiValid=function(storage){return _.all(storeApi,function(method){return _.isFunction(storage[method])})},loadBackend=function(preselectedBackend){return isIndexDBSupported().then(function(){var backend=preselectedBackend||(supportsIndexedDB?indexedDBBackend:localStorageBackend);return _.isFunction(backend)?isBackendApiValid(backend)?(backend!==memoryBackend&&checkQuotas(),backend):Promise.reject(new TypeError("This backend doesn't comply with the store backend API")):Promise.reject(new TypeError("No backend, no storage!"))})};store=function(storeName,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){var storeInstance=backend(storeName);return isStorageApiValid(storeInstance)?storeInstance:Promise.reject(new TypeError("The store doesn't comply with the Storage interface"))})},store.backends={localStorage:localStorageBackend,indexedDB:indexedDBBackend,memory:memoryBackend},store.removeAll=function(validate,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.removeAll(validate)})},store.cleanUpSpace=function(since,storeNamePattern,preselectedBackend){var tsThreshold,invalidate=function(storeName,storeEntry){return!!(storeName&&storeEntry)&&(!(storeNamePattern instanceof RegExp)||storeNamePattern.test(storeName))&&_.isNumber(storeEntry.lastOpen)&&_.isNumber(tsThreshold)&&storeEntry.lastOpen<=tsThreshold};return _.isNumber(since)&&0<since?tsThreshold=since:(!_.isString(since)&&(since=config.invalidation.oldster),tsThreshold=moment().subtract(moment.duration(since)).valueOf()),logger.info("Trying to remove stores lastly opened before "+tsThreshold+"("+since+")"),store.removeAll(invalidate,preselectedBackend)},store.getAll=function(validate,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.getAll(validate)})},store.getIdentifier=function(preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.getStoreIdentifier()})};var store$1=store;return store$1}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/store")):"function"==typeof define&&define.amd?define("core/tokenStore",["lodash","core/promise","core/store"],factory):(global=global||self,global["core/tokenStore"]=factory(global._,global["core/promise"],global["core/store"]))}(this,function(_,Promise,store){'use strict';function tokenStoreFactory(options){var config=_.defaults(options||{},defaultConfig),getStore=function(){return store("tokenStore.tokens",store.backends.memory)};return{dequeue:function(){var self=this;return self.getIndex().then(function(latestIndex){var key=_.first(latestIndex);return key?getStore().then(function(storage){return storage.getItem(key)}).then(function(token){return self.remove(key).then(function(){return token})}):Promise.resolve()})},enqueue:function(token){var self=this;return _.isString(token)&&(token={value:token,receivedAt:Date.now()}),getStore().then(function(storage){return storage.setItem(token.value,token)}).then(function(updated){return!!updated&&self.enforceMaxSize().then(function(){return!0})})},getIndex:function(){return this.getTokens().then(function(tokens){return _.chain(tokens).values().sort(function(t1,t2){return t1.receivedAt-t2.receivedAt}).map("value").value()})},has:function(key){return this.getIndex().then(function(latestIndex){return _.contains(latestIndex,key)})},remove:function(key){return this.has(key).then(function(result){return!!result&&getStore().then(function(storage){return storage.removeItem(key)})})},clear:function(){return getStore().then(function(storage){return storage.clear()})},getTokens:function(){return getStore().then(function(storage){return storage.getItems()})},getSize:function(){return this.getIndex().then(function(latestIndex){return latestIndex.length})},setMaxSize:function(size){var self=this;_.isNumber(size)&&0<size&&size!==config.maxSize&&(config.maxSize=size,self.enforceMaxSize())},enforceMaxSize:function(){var self=this;return this.getIndex().then(function(latestIndex){var keysToRemove,excess=latestIndex.length-config.maxSize;return!(0<excess)||(keysToRemove=latestIndex.slice(0,excess),Promise.all(_.map(keysToRemove,function(key){return self.remove(key)})))})},checkExpiry:function(token){return!(Date.now()-token.receivedAt>config.tokenTimeLimit)||this.remove(token.value)},expireOldTokens:function(){var self=this;return self.getTokens().then(function(tokens){return _.reduce(tokens,function(previousPromise,nextToken){return previousPromise.then(function(){return self.checkExpiry(nextToken)})},Promise.resolve()).then(function(){return!0})})}}}_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,store=store&&store.hasOwnProperty("default")?store["default"]:store;var defaultConfig={maxSize:6,tokenTimeLimit:1440000};return tokenStoreFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("module"),require("core/tokenStore"),require("core/promise"),require("core/promiseQueue")):"function"==typeof define&&define.amd?define("core/tokenHandler",["lodash","module","core/tokenStore","core/promise","core/promiseQueue"],factory):(global=global||self,global["core/tokenHandler"]=factory(global._,global.module,global["core/tokenStore"],global["core/promise"],global["core/promiseQueue"]))}(this,function(_,module,tokenStoreFactory,Promise,promiseQueue){'use strict';function tokenHandlerFactory(options){var tokenStore;return _.isString(options)&&(options={initialToken:options}),options=_.defaults({},options,defaults),tokenStore=tokenStoreFactory(options),{getToken:function(){var self=this,initialToken=options.initialToken,getFirstTokenValue=function(){return tokenStore.dequeue().then(function(currentToken){return currentToken?currentToken.value:null})};return initialToken?(options.initialToken=null,Promise.resolve(initialToken)):tokenStore.expireOldTokens().then(function(){return tokenStore.getSize()}).then(function(queueSize){return 0<queueSize?getFirstTokenValue():clientConfigFetched?Promise.reject(new Error("No tokens available. Please refresh the page.")):self.getClientConfigTokens().then(getFirstTokenValue)})},setToken:function(newToken){return tokenStore.enqueue(newToken)},getClientConfigTokens:function(){var self=this,clientTokens=_.map(module.config().tokens,function(serverToken){return{value:serverToken,receivedAt:Date.now()}});return clientConfigFetched=!0,Promise.resolve(clientTokens).then(function(newTokens){var setTokenQueue=promiseQueue();return _.forEach(newTokens,function(token){setTokenQueue.serie(function(){return self.setToken(token)})}),setTokenQueue.serie(function(){return!0})})},clearStore:function(){return tokenStore.clear()},getQueueLength:function(){return tokenStore.getSize()},setMaxSize:function(size){tokenStore.setMaxSize(size)}}}_=_&&_.hasOwnProperty("default")?_["default"]:_,module=module&&module.hasOwnProperty("default")?module["default"]:module,tokenStoreFactory=tokenStoreFactory&&tokenStoreFactory.hasOwnProperty("default")?tokenStoreFactory["default"]:tokenStoreFactory,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue["default"]:promiseQueue;var clientConfigFetched=!1,defaults={maxSize:6,tokenTimeLimit:1440000};return tokenHandlerFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash"),require("i18n"),require("module"),require("context"),require("core/promise"),require("core/promiseQueue"),require("core/tokenHandler"),require("core/logger")):"function"==typeof define&&define.amd?define("core/request",["jquery","lodash","i18n","module","context","core/promise","core/promiseQueue","core/tokenHandler","core/logger"],factory):(global=global||self,global["core/request"]=factory(global.$,global._,global.__,global.module,global.context,global["core/promise"],global["core/promiseQueue"],global["core/tokenHandler"],global["core/logger"]))}(this,function($,_,__,module,context,Promise,promiseQueue,tokenHandlerFactory,loggerFactory){'use strict';function request(options){function runRequest(){var computeHeaders=function(){var headers=_.extend({},options.headers);return options.noToken?Promise.resolve(headers):tokenHandler.getToken().then(function(token){return headers["X-CSRF-Token"]=token||"none",headers})},setTokenFromXhr=function(xhr){var token;return _.isFunction(xhr.getResponseHeader)&&(token=xhr.getResponseHeader("X-CSRF-Token"),logger.debug("received %s header %s","X-CSRF-Token",token),token)?tokenHandler.setToken(token):Promise.resolve()};return computeHeaders().then(function(customHeaders){return new Promise(function(resolve,reject){var noop;$.ajax({url:options.url,method:options.method||"GET",headers:customHeaders,data:options.data,contentType:options.contentType||noop,dataType:options.dataType||"json",async:!0,timeout:1e3*options.timeout||1e3*context.timeout||0,beforeSend:function beforeSend(){_.isEmpty(customHeaders)||logger.debug("sending %s header %s","X-CSRF-Token",customHeaders&&customHeaders["X-CSRF-Token"])},global:!options.background}).done(function(response,status,xhr){setTokenFromXhr(xhr).then(function(){return 204===xhr.status||response&&204===response.errorCode||"nocontent"===status?resolve():403===xhr.status||response&&403===response.errorCode?reject(createError(response,xhr.status+" : "+xhr.statusText,xhr.status,0<xhr.readyState)):response&&!0===response.success?resolve(response):void reject(createError(response,__("The server has sent an empty response"),xhr.status,0<xhr.readyState))}).catch(function(error){logger.error(error),reject(createError(response,error,xhr.status,0<xhr.readyState))})}).fail(function(xhr,textStatus,errorThrown){var response;try{response=JSON.parse(xhr.responseText)}catch(parseErr){response=xhr.responseText}response=_.defaults(response,{success:!1,source:"network",cause:options.url,purpose:"proxy",context:this,code:xhr.status,sent:0<xhr.readyState,type:"error",message:errorThrown||__("An error occurred!")}),setTokenFromXhr(xhr).then(function(){reject(createError(response,xhr.status+" : "+xhr.statusText,xhr.status,0<xhr.readyState))}).catch(function(error){logger.error(error),reject(createError(response,error,xhr.status,0<xhr.readyState))})})})})}if(module.config().noToken&&(options.noToken=!0),_.isEmpty(options.url))throw new TypeError("At least give a URL...");return tokenHandler.getQueueLength().then(function(queueLength){return!0===options.noToken?runRequest():options.sequential||1===queueLength?queue.serie(runRequest):runRequest()})}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,module=module&&module.hasOwnProperty("default")?module["default"]:module,context=context&&context.hasOwnProperty("default")?context["default"]:context,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue["default"]:promiseQueue,tokenHandlerFactory=tokenHandlerFactory&&tokenHandlerFactory.hasOwnProperty("default")?tokenHandlerFactory["default"]:tokenHandlerFactory,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var tokenHandler=tokenHandlerFactory(),queue=promiseQueue(),logger=loggerFactory("core/request"),createError=function(response,fallbackMessage,httpCode,httpSent){var err;return err=response&&response.errorCode?new Error(response.errorCode+" : "+(response.errorMsg||response.errorMessage||response.error)):new Error(fallbackMessage),err.response=response,err.sent=httpSent,httpCode&&(err.code=httpCode),err};return request}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/request")):"function"==typeof define&&define.amd?define("core/dataProvider/request",["lodash","core/request"],factory):(global=global||self,global["core/dataProvider/request"]=factory(global._,global["core/request"]))}(this,function(_,coreRequest){'use strict';function request(url,data,method,headers,background,noToken){return coreRequest({url:url,data:data,method:method,headers:headers,background:background,noToken:!1!==noToken}).then(function(response){if(!_.isUndefined(response)){if(response.success)return response.data;throw new Error(response.data)}})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,coreRequest=coreRequest&&coreRequest.hasOwnProperty("default")?coreRequest["default"]:coreRequest,request}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise")):"function"==typeof define&&define.amd?define("core/moduleLoader",["lodash","core/promise"],factory):(global=global||self,global["core/moduleLoader"]=factory(global._,global["core/promise"]))}(this,function(_,Promise){'use strict';function moduleLoaderFactory(requiredModules,validate,specs){var loaded={},modules={},excludes=[],bundles=[],loader={addList:function(moduleList){return _.forEach(moduleList,this.add,this),this},add:function(def){if(_.isEmpty(def.module)||!_.isString(def.module))throw new TypeError("An AMD module must be defined");if(_.isEmpty(def.category)||!_.isString(def.category))throw new TypeError("Providers must belong to a category");return modules[def.category]=modules[def.category]||[],_.isNumber(def.position)?modules[def.category][def.position]=def.module:"prepend"===def.position||"before"===def.position?modules[def.category].unshift(def.module):modules[def.category].push(def.module),def.bundle&&!_.contains(bundles,def.bundle)&&bundles.push(def.bundle),this},append:function(def){return this.add(_.merge({position:"append"},def))},prepend:function(def){return this.add(_.merge({position:"prepend"},def))},remove:function(module){return excludes.push(module),this},load:function(loadBundles){var self=this,dependencies=_(modules).values().flatten().uniq().difference(excludes).value(),loadModules=function(amdModules){return _.isArray(amdModules)&&amdModules.length?new Promise(function(resolve,reject){require(amdModules,function(){resolve([].slice.call(arguments))},reject)}):Promise.resolve()};return loadModules(loadBundles?bundles:[]).then(function(){return loadModules(dependencies)}).then(function(loadedModules){return _.forEach(dependencies,function(dependency,index){var module=loadedModules[index],category=_.findKey(modules,function(val){return _.contains(val,dependency)});if(!validate(module))throw new TypeError("Invalid module");_.isString(category)&&(loaded[category]=loaded[category]||[],loaded[category].push(module))}),self.getModules()})},getModules:function(category){return _.isString(category)?loaded[category]||[]:_(loaded).values().flatten().uniq().value()},getCategories:function(){return _.keys(loaded)}};return validate=_.isFunction(validate)?validate:_.isPlainObject,_.forEach(requiredModules,function(moduleList,category){if(_.isEmpty(category)||!_.isString(category))throw new TypeError("Modules must belong to a category");if(!_.isArray(moduleList))throw new TypeError("A list of modules must be an array");if(!_.all(moduleList,validate))throw new TypeError("The list does not contain valid modules");loaded[category]=loaded[category]?loaded[category].concat(moduleList):moduleList}),specs&&_(specs).functions().forEach(function(method){loader[method]=function(){return specs[method].apply(loader,[].slice.call(arguments))}}),loader}return _=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,moduleLoaderFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/moduleLoader")):"function"==typeof define&&define.amd?define("core/pluginLoader",["lodash","core/moduleLoader"],factory):(global=global||self,global["core/pluginLoader"]=factory(global._,global["core/moduleLoader"]))}(this,function(_,moduleLoaderFactory){'use strict';function pluginLoaderFactory(requiredPlugins){return moduleLoaderFactory(requiredPlugins,_.isFunction,{getPlugins:function(category){return this.getModules(category)}})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,moduleLoaderFactory=moduleLoaderFactory&&moduleLoaderFactory.hasOwnProperty("default")?moduleLoaderFactory["default"]:moduleLoaderFactory,pluginLoaderFactory}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/delegator",["lodash"],factory):(global=global||self,global["core/delegator"]=factory(global._))}(this,function(_){'use strict';function delegator(api,provider,config){function delegate(fnName){var response,args;if(!provider)throw new Error("There is no "+name+" provider!");else if(_.isFunction(provider[fnName])||defaultProvider)args=_slice.call(arguments,1),response=(provider[fnName]||defaultProvider).apply(context,args),wrapper&&(response=wrapper(response)),eventifier&&api.trigger.apply(api,[fnName,response].concat(args));else throw new Error("There is no method called "+fnName+" in the "+name+" provider!");return response}var extendedConfig=_.defaults(config||{},defaults),eventifier=!!(extendedConfig.eventifier&&api&&api.trigger),context=extendedConfig.forward?provider:api,defaultProvider=_.isFunction(extendedConfig.defaultProvider)?extendedConfig.defaultProvider:_.noop,wrapper=_.isFunction(extendedConfig.wrapper)?extendedConfig.wrapper:null,name=extendedConfig.name;return extendedConfig.required&&(defaultProvider=null),delegate}_=_&&_.hasOwnProperty("default")?_["default"]:_;var defaults={name:"provided",eventifier:!0},_slice=[].slice;return delegator}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/delegator"),require("core/promise")):"function"==typeof define&&define.amd?define("core/plugin",["lodash","core/delegator","core/promise"],factory):(global=global||self,global["core/plugin"]=factory(global._,global["core/delegator"],global["core/promise"]))}(this,function(_,delegator,Promise){'use strict';function pluginFactory(provider,defaults){var pluginName;if(!_.isPlainObject(provider)||!_.isString(provider.name)||_.isEmpty(provider.name)||!_.isFunction(provider.init))throw new TypeError("A plugin should be defined at least by a name property and an init method");return pluginName=provider.name,defaults=defaults||{},function(host,areaBroker,config){var plugin,delegate,states={},pluginContent={};if(!_.isObject(host)||!_.isFunction(host.on)||!_.isFunction(host.trigger))throw new TypeError("A plugin host should be a valid eventified object");return config=_.defaults(config||{},defaults),plugin={install:function(){var self=this;return delegate("install").then(function(){self.trigger("install")})},init:function(content){var self=this;return states={},content&&(pluginContent=content),delegate("init",content).then(function(){self.setState("init",!0).trigger("init")})},render:function(){var self=this;return delegate("render").then(function(){self.setState("ready",!0).trigger("render").trigger("ready")})},finish:function(){var self=this;return delegate("finish").then(function(){self.setState("finish",!0).trigger("finish")})},destroy:function(){var self=this;return delegate("destroy").then(function(){config={},states={},self.setState("init",!1),self.trigger("destroy")})},trigger:function(name){var args=[].slice.call(arguments,1);return host.trigger.apply(host,["plugin-"+name+"."+pluginName,plugin].concat(args)),this},getHost:function(){return host},getAreaBroker:function(){return areaBroker},getConfig:function(){return config},setConfig:function(name,value){return _.isPlainObject(name)?config=_.defaults(name,config):config[name]=value,this},getState:function(name){return!!states[name]},setState:function(name,active){if(!_.isString(name)||_.isEmpty(name))throw new TypeError("The state must have a name");return states[name]=!!active,this},getContent:function(){return pluginContent},setContent:function(content){return pluginContent=content,this},getName:function(){return pluginName},show:function(){var self=this;return delegate("show").then(function(){self.setState("visible",!0).trigger("show")})},hide:function(){var self=this;return delegate("hide").then(function(){self.setState("visible",!1).trigger("hide")})},enable:function(){var self=this;return delegate("enable").then(function(){self.setState("enabled",!0).trigger("enable")})},disable:function(){var self=this;return delegate("disable").then(function(){self.setState("enabled",!1).trigger("disable")})}},delegate=delegator(plugin,provider,{eventifier:!1,wrapper:function(response){return Promise.resolve(response)}}),_.isString(defaults.hostName)&&!_.isEmpty(defaults.hostName)&&(plugin["get"+defaults.hostName.charAt(0).toUpperCase()+defaults.hostName.slice(1)]=plugin.getHost),plugin}}return _=_&&_.hasOwnProperty("default")?_["default"]:_,delegator=delegator&&delegator.hasOwnProperty("default")?delegator["default"]:delegator,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,pluginFactory}),define("taoOutcomeUi/plugins/results/action/view",["i18n","layout/actions/binder","core/plugin","util/url"],function(__,binder,pluginFactory,urlHelper){'use strict';return pluginFactory({name:"view",init:function(){var resultsList=this.getHost(),action={binding:"load",url:urlHelper.route("viewResult","Results","taoOutcomeUi")};resultsList.addAction({id:"view",label:__("View"),icon:"view",action:function(id){var context={id:id,classUri:resultsList.getClassUri()};binder.exec(action,context)}})}})}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("util/namespace",["lodash"],factory):(global=global||self,global["util/namespace"]=factory(global._))}(this,function(_){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_;var reSplit=/\s/g,namespaceSep=".",namespaceHelper={split:function(names,normalize){return!_.isString(names)||_.isEmpty(names)?[]:(normalize&&(names=names.toLowerCase()),_(names.trim().split(reSplit)).compact().uniq().value())},getName:function(namespaced){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(namespaceSep)?namespaced.substr(0,namespaced.indexOf(namespaceSep)):namespaced},getNamespace:function(namespaced,defaultNs){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(namespaceSep)?namespaced.substr(namespaced.indexOf(namespaceSep)+1):defaultNs||"@"},namespaceAll:function(names,namespace,normalize){var suffix;return _.isArray(names)||(names=namespaceHelper.split(names,normalize)),normalize&&(namespace=namespace.toLowerCase()),suffix=namespace?namespaceSep+namespace:"",_(names).map(function(sh){return 0>sh.indexOf(namespaceSep)?sh+suffix:sh}).compact().uniq().value().join(" ")}};return namespaceHelper}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash"),require("util/namespace")):"function"==typeof define&&define.amd?define("util/shortcut/registry",["jquery","lodash","util/namespace"],factory):(global=global||self,global["util/shortcut/registry"]=factory(global.$,global._,global["util/namespace"]))}(this,function($,_,namespaceHelper){'use strict';var _StringfromCharCode=String.fromCharCode;function registerEvent(target,eventName,listener){target.addEventListener?target.addEventListener(eventName,listener,!1):target.attachEvent?target.attachEvent("on"+eventName,listener):target["on"+eventName]=listener}function unregisterEvent(target,eventName,listener){target.removeEventListener?target.removeEventListener(eventName,listener,!1):target.detachEvent?target.detachEvent("on"+eventName,listener):target["on"+eventName]=null}function getActualKey(event){var code=event.which||event.keyCode,character=32<=code?_StringfromCharCode(code).toLowerCase():"",key=event.key&&event.key.toLowerCase(),keyName=event.code&&event.code.toLowerCase();return keyName&&(0===keyName.indexOf("key")?("a">key||"z"<key)&&"a"<=character&&"z">=character&&(key=character):0===keyName.indexOf("digit")&&(key=keyName.substr(5))),specialKeys[code]||key||character}function getActualButton(event){var buttons={clickLeft:!1,clickRight:!1,clickMiddle:!1,clickBack:!1,clickForward:!1};if(event.buttons)buttons.clickLeft=!!(1&event.buttons),buttons.clickRight=!!(2&event.buttons),buttons.clickMiddle=!!(4&event.buttons),buttons.clickBack=!!(8&event.buttons),buttons.clickForward=!!(16&event.buttons);else switch(event.button){case 0:buttons.clickLeft=!0;break;case 1:buttons.clickMiddle=!0;break;case 2:buttons.clickRight=!0;break;case 3:buttons.clickBack=!0;break;case 4:buttons.clickForward=!0;}return buttons}function getActualScroll(event){return{scrollUp:0>event.deltaY,scrollDown:0<event.deltaY}}function normalizeCommand(descriptor){var key=translateKeys[descriptor.key]||descriptor.key,parts=[];return descriptor.ctrlKey&&parts.push("control"),descriptor.altKey&&parts.push("alt"),descriptor.shiftKey&&parts.push("shift"),descriptor.metaKey&&parts.push("meta"),descriptor.scrollDown&&parts.push("scrollDown"),descriptor.scrollUp&&parts.push("scrollUp"),descriptor.clickLeft&&parts.push("clickLeft"),descriptor.clickRight&&parts.push("clickRight"),descriptor.clickMiddle&&parts.push("clickMiddle"),descriptor.clickBack&&parts.push("clickBack"),descriptor.clickForward&&parts.push("clickForward"),key&&0>parts.indexOf(key)&&parts.push(key),parts.join("+")}function parseCommand(shortcut){var parts=namespaceHelper.getName(shortcut).split("+"),descriptor={keyboardInvolved:!1,mouseClickInvolved:!1,mouseWheelInvolved:!1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:null,scrollUp:null,scrollDown:null,clickLeft:null,clickRight:null,clickMiddle:null,clickBack:null,clickForward:null};return _.forEach(parts,function(part){if(modifiers[part])descriptor[modifiers[part]]=!0;else if(0<=part.indexOf("mouse")){if(descriptor.keyboardInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");0<=part.indexOf("scroll")&&(descriptor.mouseWheelInvolved=!0,descriptor.scrollUp=0<=part.indexOf("up"),descriptor.scrollDown=0<=part.indexOf("down")),0<=part.indexOf("click")&&(descriptor.mouseClickInvolved=!0,descriptor.clickLeft=0<=part.indexOf("left"),descriptor.clickRight=0<=part.indexOf("right"),descriptor.clickMiddle=0<=part.indexOf("middle"),descriptor.clickBack=0<=part.indexOf("back"),descriptor.clickForward=0<=part.indexOf("forward"))}else{if(descriptor.mouseClickInvolved||descriptor.mouseWheelInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");descriptor.keyboardInvolved=!0,descriptor.key=part}}),descriptor}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,namespaceHelper=namespaceHelper&&namespaceHelper.hasOwnProperty("default")?namespaceHelper["default"]:namespaceHelper;var modifiers={ctrl:"ctrlKey",alt:"altKey",option:"altKey",shift:"shiftKey",meta:"metaKey",cmd:"metaKey",win:"metaKey"},translateKeys={escape:"esc",arrowdown:"down",arrowleft:"left",arrowright:"right",arrowup:"up"},specialKeys={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"meta",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scrolllock",144:"numlock"};return function(root,defaultOptions){function getHandlers(command,namespace){return handlers[namespace]=handlers[namespace]||{},handlers[namespace][command]=handlers[namespace][command]||[],handlers[namespace][command]}function getCommandHandlers(command){return _.reduce(handlers,function(acc,nsHandlers){return nsHandlers[command]&&(acc=acc.concat(nsHandlers[command])),acc},[])}function clearHandlers(command,namespace){namespace&&!command?handlers[namespace]={}:_.forEach(handlers,function(nsHandlers,ns){nsHandlers[command]&&("*"===namespace||namespace===ns)&&(nsHandlers[command]=[])})}function setOptions(descriptor,options){descriptor.options=_.defaults(_.merge(descriptor.options||{},options),defaultOptions)}function registerKeyboard(){keyboardIsRegistered||(registerEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!0),keyboardCount++}function unregisterKeyboard(){keyboardCount--,0>=keyboardCount&&(keyboardCount=0,keyboardIsRegistered&&(unregisterEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!1))}function registerMouseClick(){mouseClickIsRegistered||(registerEvent(root,"click",onMouseClick),mouseClickIsRegistered=!0),mouseClickCount++}function unregisterMouseClick(){mouseClickCount--,0>=mouseClickCount&&(mouseClickCount=0,mouseClickIsRegistered&&(unregisterEvent(root,"click",onMouseClick),mouseClickIsRegistered=!1))}function registerMouseWheel(){mouseWheelIsRegistered||(registerEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!0),mouseWheelCount++}function unregisterMouseWheel(){mouseWheelCount--,0>=mouseWheelCount&&(mouseWheelCount=0,mouseWheelIsRegistered&&(unregisterEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!1))}function registerCommand(command,descriptor){shortcuts[command]=descriptor,descriptor.keyboardInvolved&&registerKeyboard(),descriptor.mouseClickInvolved&&registerMouseClick(),descriptor.mouseWheelInvolved&&registerMouseWheel()}function unregisterCommand(command){var descriptor=shortcuts[command];shortcuts[command]=null,descriptor&&(descriptor.keyboardInvolved&&unregisterKeyboard(),descriptor.mouseClickInvolved&&unregisterMouseClick(),descriptor.mouseWheelInvolved&&unregisterMouseWheel())}function onKeyboard(event){processShortcut(event,{keyboardInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey,key:getActualKey(event)})}function onMouseClick(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},getActualButton(event)))}function onMouseWheel(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},getActualScroll(event)))}function processShortcut(event,descriptor){var shortcutHandlers,$target,command=normalizeCommand(descriptor),shortcut=shortcuts[command];if(shortcut&&!states.disabled){if(!0===shortcut.options.avoidInput&&($target=$(event.target),$target.closest("[type=\"text\"],textarea").length&&(!shortcut.options.allowIn||!$target.closest(shortcut.options.allowIn).length)))return;!1===shortcut.options.propagate&&event.stopPropagation(),!0===shortcut.options.prevent&&event.preventDefault(),shortcutHandlers=getCommandHandlers(command),shortcutHandlers&&_.forEach(shortcutHandlers,function(handler){handler(event,command)})}}var keyboardIsRegistered=!1,mouseClickIsRegistered=!1,mouseWheelIsRegistered=!1,keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,shortcuts={},handlers={},states={};return root.jquery&&(root=root.get(0)),{set:function(shortcut,options){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor)}),this},add:function(shortcut,handler,options){return _.isFunction(handler)&&_.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor),getHandlers(command,namespace).push(handler)}),this},remove:function(shortcut){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);clearHandlers(command,namespace),getCommandHandlers(command).length||unregisterCommand(command)}),this},exists:function(shortcut){var normalized=(shortcut+"").trim().toLowerCase(),namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor),shortcutExists=!1;return shortcuts[command]?shortcutExists="*"===namespace||!!getHandlers(command,namespace).length:!command&&(shortcutExists=!_.isEmpty(handlers[namespace])),shortcutExists},clear:function(){return shortcuts={},handlers={},keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,unregisterKeyboard(),unregisterMouseClick(),unregisterMouseWheel(),this},getState:function(name){return!!states[name]},setState:function(name,state){return states[name]=!!state,this},enable:function(){return this.setState("disabled",!1),this},disable:function(){return this.setState("disabled",!0),this}}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash")):"function"==typeof define&&define.amd?define("core/pluginifier",["jquery","lodash"],factory):(global=global||self,global["core/pluginifier"]=factory(global.$,global._))}(this,function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var basePlugin={options:function options(dataNs,ns,_options){return this.each(function(){var $elt=$(this),currentOptions=$elt.data(dataNs);currentOptions&&$elt.data(dataNs,_.merge(currentOptions,_options))})},disable:function disable(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.addClass(options.disableClass||"disabled").trigger("disable."+ns)})},enable:function enable(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.removeClass(options.disableClass||"disabled").trigger("enable."+ns)})}};return{register:function register(pluginName,plugin,config){config=config||{};var ns=config.ns||pluginName.toLowerCase(),dataNs=config.dataNs||"ui."+ns,expose=config.expose||[];return _.isFunction($.fn[pluginName])?$.error("A plugin named "+pluginName+" is already registered"):_.isPlainObject(plugin)&&_.isFunction(plugin.init)?void(_.assign(plugin,_.transform(basePlugin,function(result,prop,key){_.isFunction(prop)&&(result[key]=_.partial(basePlugin[key],dataNs,ns))})),_.forEach(expose,function(toExposeName){var privateMethod=toExposeName,publicMethod=toExposeName;/^_/.test(expose)?publicMethod=publicMethod.replace(/^_/,""):privateMethod="_"+privateMethod,_.isFunction(plugin[privateMethod])&&!_.isFunction(plugin[publicMethod])&&(plugin[publicMethod]=function(){var returnValue,args=Array.prototype.slice.call(arguments,0);return this.each(function(){returnValue=plugin[privateMethod].apply(plugin,[$(this)].concat(args))}),returnValue||this})}),$.fn[pluginName]=function(method){if(plugin[method]){if(/^_/.test(method))$.error("Trying to call a private method `"+method+"`");else return plugin[method].apply(this,Array.prototype.slice.call(arguments,1));}else if("object"===_typeof(method)||!method)return plugin.init.apply(this,arguments);$.error("Method "+method+" does not exist on plugin")}):$.error("The object to register as a jQuery plugin must be a plain object with an `init` method.")}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash")):"function"==typeof define&&define.amd?define("core/dataattrhandler",["jquery","lodash"],factory):(global=global||self,global["core/dataattrhandler"]=factory(global.$,global._))}(this,function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var defaults={container:!1,listenerEvent:"click",useTarget:!0,bubbled:!1},letDefaultOn=[":radio",":checkbox"],shouldPreventDefault=function($elt){return!$elt.is(letDefaultOn.join(","))},DataAttrHandler=function(attrName,options){var self=this;this.options=_.defaults(options,defaults);var selector="[data-"+attrName+"]";return _.has(this.options,"namespace")&&_.isString(this.options.namespace)?void(this.options.container&&this.options.container.selector&&(selector=this.options.container.selector+" "+selector),this.options.inner&&(selector+=" "+this.options.inner),$(document).off(this.options.listenerEvent,selector).on(this.options.listenerEvent,selector,function(e){var $elt=$(e.target);if(!0===self.options.bubbled||$elt.is(selector)){var $target,$outer;void 0===$elt.data(attrName)&&(self.options.inner||self.options.bubbled)&&($outer=$elt,$elt=$elt.parents("[data-"+attrName+"]")),$target=!0===self.options.useTarget?DataAttrHandler.getTarget(attrName,$elt):self.options.inner?$outer:void 0,$elt.data(self.options.namespace)||("function"==typeof self.createPlugin&&self.createPlugin($elt,$target),$elt.is(":radio")&&$elt.attr("name")&&$(":radio[name=\""+$elt.attr("name")+"\"]").not($elt).on(self.options.listenerEvent,function(e){"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()})),"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()}})):$.error("The plugin data namespace option is required")};return DataAttrHandler.prototype.init=function(cb){return this.createPlugin=cb,this},DataAttrHandler.prototype.trigger=function(cb){return this.callPluginMethod=cb,this},DataAttrHandler.getTarget=function(attrName,$elt){var relativeRegex=/^(\+|>|~|:parent|<)/,$target=[],targetSelector=$elt.attr("data-"+attrName)||$elt.attr("href")||$elt.attr("attrName");if(!_.isEmpty(targetSelector)){var matches=relativeRegex.exec(targetSelector);if(null!==matches){var selector=targetSelector.replace(relativeRegex,"");$target=":parent"===matches[0]||"<"===matches[0]?$elt.parents(selector):"~"===matches[0]?$elt.siblings(selector):"+"===matches[0]?$elt.next(selector):$(selector,$elt)}else $target=$(targetSelector)}return $target},DataAttrHandler}),define("taoOutcomeUi/plugins/results/action/delete",["jquery","i18n","uri","core/plugin","util/url","util/encode","ui/dialog/confirm","ui/feedback"],function($,__,uri,pluginFactory,urlHelper,encode,dialogConfirm,feedback){'use strict';return pluginFactory({name:"delete",init:function(){var resultsList=this.getHost();resultsList.addAction({id:"delete",label:__("Delete"),icon:"delete",action:function(id){dialogConfirm(__("Please confirm deletion"),function(){$.ajax({url:urlHelper.route("delete","Results","taoOutcomeUi"),type:"POST",data:{uri:uri.encode(id)},dataType:"json"}).done(function(response){response.deleted?(feedback().success(__("Result has been deleted")),resultsList.refresh()):(feedback().error(__("Something went wrong...")+"<br>"+encode.html(response.error),{encodeHtml:!1}),resultsList.trigger("error",response.error))}).fail(function(err){feedback().error(__("Something went wrong...")),resultsList.trigger("error",err)})})}})}})}),define("taoOutcomeUi/plugins/results/action/download",["jquery","i18n","core/plugin","util/url","jquery.fileDownload"],function($,__,pluginFactory,urlHelper){'use strict';return pluginFactory({name:"download",init:function(){var resultsList=this.getHost();resultsList.addAction({id:"download",label:__("Download"),icon:"download",action:function(id){$.fileDownload(urlHelper.route("downloadXML","Results","taoOutcomeUi"),{preparingMessageHtml:__("We are preparing your report, please wait..."),failMessageHtml:__("There was a problem generating your report, please try again."),httpMethod:"GET",data:{id:id,delivery:resultsList.getClassUri()}})}})}})}),define("taoOutcomeUi/component/results/pluginsLoader",["core/pluginLoader","taoOutcomeUi/plugins/results/action/view","taoOutcomeUi/plugins/results/action/delete","taoOutcomeUi/plugins/results/action/download"],function(pluginLoader,actionView,actionDelete,actionDownload){'use strict';return pluginLoader({action:[actionView,actionDelete,actionDownload]})}),define("taoOutcomeUi/component/results/areaBroker",["lodash","ui/areaBroker"],function(_,areaBroker){'use strict';return _.partial(areaBroker,["list"])}),define("tpl!taoOutcomeUi/component/results/list",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"component results-list\">\n    <div class=\"list\"></div>\n</div>"})}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/providerRegistry",["lodash"],factory):(global=global||self,global["core/providerRegistry"]=factory(global._))}(this,function(_){'use strict';return _=_&&_.hasOwnProperty("default")?_["default"]:_,function(target,validator){function registerProvider(name,provider){var valid=!0;if(!_.isString(name)||0>=name.length)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init))throw new TypeError("A provider is an object that contains at least an init function.");return valid=validator&&_.isFunction(validator)?validator(provider):valid,valid&&(_providers[name]=provider),this}function getProvider(providerName){var provider;if(!_providers||0===_.size(_providers))throw new Error("No provider registered");if(_.isString(providerName)&&0<providerName.length?provider=_providers[providerName]:1===_.size(_providers)&&(providerName=_.keys(_providers)[0],provider=_providers[providerName]),!provider)throw new Error("No candidate found for the provider");return provider}function getAvailableProviders(){return _.keys(_providers)}var _providers={};return target=target||{},target.registerProvider=registerProvider,target.getProvider=getProvider,target.getAvailableProviders=getAvailableProviders,target.clearProviders=function(){return _providers={},this},target}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/httpErrorParser",factory):(global=global||self,global["util/httpErrorParser"]=factory())}(this,function(){'use strict';return{parse:function(xhr,options,errorThrown){var msg,json,error;try{json=JSON.parse(xhr.responseText),msg=json.message?json.message:errorThrown}catch(e){msg=errorThrown}return error=new Error(msg),error.response=xhr,error.code=xhr.status,error.errorThrown=errorThrown,error}}}),define("taoOutcomeUi/component/results/list",["jquery","i18n","lodash","uri","core/promise","ui/component","taoOutcomeUi/component/results/areaBroker","tpl!taoOutcomeUi/component/results/list","ui/datatable"],function($,__,_,uri,Promise,component,resultsAreaBroker,listTpl){'use strict';return function(config,pluginFactories){function pluginRun(method){var execStack=[];return _.forEach(plugins,function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)}var resultsList,areaBroker,classUri,plugins={},actions=[];if(!_.isPlainObject(config))throw new TypeError("The configuration is required");if(!_.isString(config.classUri)||!config.classUri)throw new TypeError("The class URI is required");if(!_.isString(config.dataUrl)||!config.dataUrl)throw new TypeError("The service URL is required");if(!_.isPlainObject(config.model)&&!_.isArray(config.model))throw new TypeError("The data model is required");return classUri=uri.decode(config.classUri),resultsList=component({refresh:function(){return areaBroker.getListArea().datatable("refresh"),this},addAction:function(name,action){var descriptor;return _.isPlainObject(name)?descriptor=name:_.isPlainObject(action)?(descriptor=action,action.id=name):descriptor={id:name,label:name},_.isFunction(action)&&(descriptor.action=action),descriptor.label||(descriptor.label=descriptor.id),actions.push(descriptor),this},getConfig:function(){return this.config},getClassUri:function(){return classUri},getActions:function(){return actions}}),resultsList.before("render",function(){var self=this;return areaBroker=resultsAreaBroker(this.$component,{list:$(".list",this.$component)}),_.forEach(pluginFactories,function(pluginFactory){var plugin=pluginFactory(self,areaBroker);plugins[plugin.getName()]=plugin}),pluginRun("init").then(function(){return pluginRun("render")}).then(function(){areaBroker.getListArea().empty().on("query.datatable",function(){self.setState("loading",!0).trigger("loading")}).on("load.datatable",function(){self.setState("loading",!1).trigger("loaded")}).datatable({url:self.config.dataUrl,model:self.config.model,actions:actions,filter:self.config.searchable,labels:{filter:__("Search by delivery results")}})}).catch(function(err){return self.trigger("error",err),Promise.reject(err)})}).before("destroy",function(){var self=this;return pluginRun("destroy").then(function(){areaBroker.getListArea().empty()}).catch(function(err){self.trigger("error",err)})}).setTemplate(listTpl).init(config)}}),define("taoOutcomeUi/controller/inspectResults",["jquery","lodash","i18n","module","core/logger","util/url","layout/actions/binder","layout/loading-bar","ui/feedback","ui/taskQueue/taskQueue","taoOutcomeUi/component/results/pluginsLoader","taoOutcomeUi/component/results/list","ui/taskQueueButton/treeButton"],function($,_,__,module,loggerFactory,urlHelper,binder,loadingBar,feedback,taskQueue,resultsPluginsLoader,resultsListFactory,treeTaskButtonFactory){'use strict';function reportError(err){loadingBar.stop(),logger.error(err),err instanceof Error&&feedback().error(err.message)}var logger=loggerFactory("controller/inspectResults");return{start:function start(){var taskButton,config=module.config()||{},$container=$("#inspect-result"),classUri=$container.data("uri"),listConfig={dataUrl:urlHelper.route("getResults","Results","taoOutcomeUi",{classUri:classUri}),model:config.dataModel,searchable:config.searchable,classUri:classUri};loadingBar.start(),_.forEach(config.plugins,function(plugin){plugin&&plugin.module&&(plugin.exclude?resultsPluginsLoader.remove(plugin.module):resultsPluginsLoader.add(plugin))}),$container.length?resultsPluginsLoader.load().then(function(){resultsListFactory(listConfig,resultsPluginsLoader.getPlugins()).on("error",reportError).on("success",function(message){feedback().success(message)}).before("loading",function(){loadingBar.start()}).after("loaded",function(){loadingBar.stop()}).render($(".inspect-results-grid",$container))}).catch(reportError):loadingBar.stop(),taskButton=treeTaskButtonFactory({replace:!0,icon:"export",label:__("Export CSV"),taskQueue:taskQueue}).render($("#results-csv-export")),binder.register("export_csv",function(actionContext){var data=_.pick(actionContext,["uri","classUri","id"]),uniqueValue=data.uri||data.classUri||"";taskButton.setTaskConfig({taskCreationUrl:this.url,taskCreationData:{uri:uniqueValue}}).start()})}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("module"),require("moment")):"function"==typeof define&&define.amd?define("util/locale",["module","moment"],factory):(global=global||self,global["util/locale"]=factory(global.module,global.moment))}(this,function(module,moment){'use strict';module=module&&module.hasOwnProperty("default")?module["default"]:module,moment=moment&&moment.hasOwnProperty("default")?moment["default"]:moment;var configuration=module.config(),locale={getConfig:function(){return configuration},setConfig:function(config){configuration=config||{}},getDecimalSeparator:function(){return this.getConfig()&&this.getConfig().decimalSeparator?this.getConfig().decimalSeparator:"."},getThousandsSeparator:function(){return this.getConfig()&&this.getConfig().thousandsSeparator?this.getConfig().thousandsSeparator:""},getDateTimeFormat:function(){return this.getConfig()&&this.getConfig().dateTimeFormat?this.getConfig().dateTimeFormat:"DD/MM/YYYY HH:mm:ss"},parseFloat:function(_parseFloat){function parseFloat(){return _parseFloat.apply(this,arguments)}return parseFloat.toString=function(){return _parseFloat.toString()},parseFloat}(function(numStr){var thousandsSeparator=this.getThousandsSeparator(),decimalSeparator=this.getDecimalSeparator();return thousandsSeparator.length&&(numStr=numStr.replace(new RegExp("\\"+thousandsSeparator,"g"),"")),"."!==decimalSeparator&&(numStr=numStr.replace(/\./g,"_").replace(new RegExp("\\"+decimalSeparator,"g"),".")),parseFloat(numStr)}),parseInt:function(_parseInt){function parseInt(){return _parseInt.apply(this,arguments)}return parseInt.toString=function(){return _parseInt.toString()},parseInt}(function(number,numericBase){var thousandsSeparator=this.getThousandsSeparator();return thousandsSeparator.length&&(number=number.replace(new RegExp("\\"+thousandsSeparator,"g"),"")),parseInt(number,numericBase)}),formatDateTime:function formatDateTime(timestamp){return moment(timestamp,"X").format(this.getDateTimeFormat())}};return locale}),define("tpl!taoOutcomeUi/controller/resultModal",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"modal results-modal\">\n\n</div>"})}),define("taoOutcomeUi/controller/resultsMonitoring",["jquery","lodash","i18n","util/url","uri","ui/feedback","util/locale","util/encode","layout/loading-bar","layout/actions/binder","ui/dialog/confirm","tpl!taoOutcomeUi/controller/resultModal","ui/datatable"],function($,_,__,url,uri,feedback,locale,encode,loadingBar,binder,dialogConfirm,resultModalTpl){'use strict';function getNumRows(){var $upperElem=$(".content-container h2"),topSpace=$upperElem.offset().top+$upperElem.height()+parseInt($upperElem.css("margin-bottom"),10)+30+70,availableHeight=$window.height()-topSpace-$("footer.dark-bar").outerHeight();return window.MSInputMethodContext||document.documentMode||window.StyleMedia?Math.min(Math.floor(availableHeight/30),25):25}function getRequestErrorMessage(xhr){loadingBar.start();var message="";try{var responseJSON=$.parseJSON(xhr.responseText);message=responseJSON.message?responseJSON.message:xhr.responseText}catch(e){message=xhr.responseText}return message}function viewResult(rowId){var res=parseRowId(rowId);loadingBar.start(),$.ajax({url:url.route("viewResult","Results","taoOutcomeUi",{id:res[0],classUri:res[1]}),type:"GET",success:function success(result){var $container=$(resultModalTpl()).append(result);$resultsListContainer.append($container),$container.modal({startClosed:!1,minWidth:450,top:50}),$container.css({"max-height":$window.height()-80+"px",overflow:"auto"}),$container.on("click",function(e){var $target=$(e.target),$element=null;if($target.is("a")&&$target.hasClass("preview")?$element=$target:$target.is("span")&&$target.parent().hasClass("preview")&&($element=$target.parent()),$element){var $modalContainer=$element.parents(".modal");$modalContainer.length&&$modalContainer.trigger("closed.modal"),$(".preview-overlay").css({zIndex:$container.modal().css("z-index")+1})}}),$container.on("closed.modal",function(){$container.modal("destroy"),$(".modal-bg").remove(),$(this).remove()}),loadingBar.stop()},error:function error(xhr){var message=getRequestErrorMessage(xhr);feedback().error(message,{encodeHtml:!1}),loadingBar.stop()}})}function checkValidItem(){return!this.start_time}function downloadResult(rowId){var res=parseRowId(rowId);$.fileDownload(url.route("downloadXML","Results","taoOutcomeUi"),{preparingMessageHtml:__("We are preparing your report, please wait..."),failMessageHtml:__("There was a problem generating your report, please try again."),httpMethod:"GET",data:{id:res[0],delivery:res[1]}})}function parseRowId(rowId){return rowId.split("|")}var $resultsListContainer=$(".results-list-container"),$window=$(window);return{start:function start(){var $contentBlock=$resultsListContainer.parents(".content-block"),resizeContainer=function(){var padding=$contentBlock.innerHeight()-$contentBlock.height();$contentBlock.height($window.height()-$("footer.dark-bar").outerHeight()-$("header.dark-bar").outerHeight()-$(".tab-container").outerHeight()-$(".action-bar.content-action-bar").outerHeight()-padding)};$window.on("resize",_.debounce(resizeContainer,300)),resizeContainer(),$resultsListContainer.datatable({url:url.route("data","ResultsMonitoring","taoOutcomeUi"),filter:!0,labels:{filter:__("Search by results")},model:[{id:"delivery",label:__("Delivery"),sortable:!1},{id:"deliveryResultIdentifier",label:__("Delivery Execution"),sortable:!1},{id:"testTakerIdentifier",label:__("Test Taker"),sortable:!1},{id:"start_time",label:__("Start Time"),sortable:!1}],paginationStrategyTop:"simple",paginationStrategyBottom:"pages",rows:getNumRows(),sortby:"result_id",sortorder:"desc",actions:{view:{id:"view",label:__("View"),icon:"external",action:viewResult,disabled:checkValidItem},download:{id:"download",title:__("Download result"),icon:"download",label:__("Download"),action:downloadResult,disabled:checkValidItem}}})}}}),define("taoOutcomeUi/controller/resultTable",["jquery","lodash","i18n","module","util/url","ui/feedback","ui/taskQueue/taskQueue","ui/taskQueueButton/standardButton","ui/dateRange/dateRange","ui/datatable"],function($,_,__,module,urlUtil,feedback,taskQueue,standardTaskButtonFactory,dateRangeFactory){'use strict';return{start:function(){var conf=module.config(),$container=$(".result-table"),$filterField=$(".result-filter",$container),$filterButtonsContainer=$(".filter-buttons",$container),$tableContainer=$(".result-table-container",$container),$dateStartRangeContainer=$(".de-start-range",$container),$dateEndRangeContainer=$(".de-end-range",$container),filter=conf.filter||"lastSubmitted",deStartFrom="",deStartTo="",deEndFrom="",deEndTo="",uri=conf.uri||"",columns=[],groups={},filterDeStartRange=dateRangeFactory($dateStartRangeContainer).on("render",function(){$("button",$dateStartRangeContainer).hide()}),filterDeEndRange=dateRangeFactory($dateEndRangeContainer).on("render",function(){$("button",$dateEndRangeContainer).hide()}),buildGrid=function(url,action,done){$.ajax({url:url,dataType:"json",data:{filter:filter,uri:uri},type:"GET"}).done(function(response){response&&response.columns&&(columns="remove"===action?_.reject(columns,function(col){return _.find(response.columns,function(resCol){return _.isEqual(col,resCol)})}):"undefined"!=typeof response.first&&!0===response.first?response.columns.concat(columns):columns.concat(response.columns),_buildTable(done))})},_buildTable=function(done){var model=[];_.forEach(columns,function(col){model.push({id:col.prop?col.prop+"_"+col.contextType:col.contextId+"_"+col.variableIdentifier,label:col.label,sortable:!1})}),$tableContainer.empty().data("ui.datatable",null).off("load.datatable").on("load.datatable",function(){_.isFunction(done)&&(done(),done="")}).datatable({url:urlUtil.route("feedDataTable","ResultTable","taoOutcomeUi",{filter:filter,startfrom:deStartFrom,startto:deStartTo,endfrom:deEndFrom,endto:deEndTo}),querytype:"POST",params:{columns:JSON.stringify(columns),_search:!1,uri:uri},model:model})},filterChanged=function(){filter=$filterField.select2("val"),deStartFrom=filterDeStartRange.getStart(),deStartTo=filterDeStartRange.getEnd(),deEndFrom=filterDeEndRange.getStart(),deEndTo=filterDeEndRange.getEnd(),_buildTable()};$("[data-group]",$container).each(function(){var $elt=$(this),group=$elt.data("group"),action=$elt.data("action");groups[group]=groups[group]||{},groups[group][action]=$elt}),$container.on("click","[data-group]",function(e){var $elt=$(this),group=$elt.data("group"),action=$elt.data("action"),url=$elt.data("url");e.preventDefault(),buildGrid(url,action,function(){_.forEach(groups[group],function($btn){$btn.toggleClass("hidden")})})}),buildGrid(urlUtil.route("getTestTakerColumns","ResultTable","taoOutcomeUi",{filter:filter})),$filterField.select2({minimumResultsForSearch:-1}).select2("val",filter),$(".result-filter-btn",$container).click(function(){filterChanged()}),standardTaskButtonFactory({type:"info",icon:"export",title:__("Export CSV File"),label:__("Export CSV File"),taskQueue:taskQueue,taskCreationUrl:urlUtil.route("export","ResultTable","taoOutcomeUi"),taskCreationData:function(){return filterChanged(),{filter:filter,columns:JSON.stringify(columns),uri:uri,startfrom:deStartFrom,startto:deStartTo,endfrom:deEndFrom,endto:deEndTo}}}).on("error",function(err){feedback().error(err)}).render($filterButtonsContainer)}}}),define("taoOutcomeUi/controller/routes",[],function(){'use strict';return{Results:{actions:{viewResult:"controller/viewResult",index:"controller/inspectResults"}},ResultTable:{actions:{index:"controller/resultTable"}},ResultsMonitoring:{actions:{index:"controller/resultsMonitoring"}}}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/moduleLoader")):"function"==typeof define&&define.amd?define("core/providerLoader",["lodash","core/moduleLoader"],factory):(global=global||self,global["core/providerLoader"]=factory(global._,global["core/moduleLoader"]))}(this,function(_,moduleLoaderFactory){'use strict';function validateProvider(provider){return _.isPlainObject(provider)&&_.isFunction(provider.init)&&_.isString(provider.name)&&!_.isEmpty(provider.name)}function providerLoader(requiredProviders){return moduleLoaderFactory(requiredProviders,validateProvider,{getProviders:function(category){return this.getModules(category)}})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,moduleLoaderFactory=moduleLoaderFactory&&moduleLoaderFactory.hasOwnProperty("default")?moduleLoaderFactory["default"]:moduleLoaderFactory,providerLoader}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/strPad",factory):(global=global||self,global["util/strPad"]=factory())}(this,function(){'use strict';return function strPad(input,pad_length,pad_string,pad_type){var pad_to_go,_Mathceil=Math.ceil,half="",str_pad_repeater=function(s,len){for(var collect="";collect.length<len;)collect+=s;return collect=collect.substr(0,len),collect};return input=input.toString(),input+="",pad_string=void 0===pad_string?" ":pad_string,"STR_PAD_LEFT"!==pad_type&&"STR_PAD_RIGHT"!==pad_type&&"STR_PAD_BOTH"!==pad_type&&(pad_type="STR_PAD_RIGHT"),0<(pad_to_go=pad_length-input.length)&&("STR_PAD_LEFT"===pad_type?input=str_pad_repeater(pad_string,pad_to_go)+input:"STR_PAD_RIGHT"===pad_type?input+=str_pad_repeater(pad_string,pad_to_go):"STR_PAD_BOTH"==pad_type&&(half=str_pad_repeater(pad_string,_Mathceil(pad_to_go/2)),input=half+input+half,input=input.substr(0,pad_length))),input}}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("util/urlParser",["lodash"],factory):(global=global||self,global["util/urlParser"]=factory(global._))}(this,function(_){'use strict';function UrlParser(url){var detachedAnchor;this.url=url,detachedAnchor=document.createElement("a"),detachedAnchor.href=url,this.data=_.pick(detachedAnchor,urlParts),this.params=UrlParser.extractParams(this.data.search)}_=_&&_.hasOwnProperty("default")?_["default"]:_;var urlParts=["hash","host","hostname","pathname","port","protocol","search"];return UrlParser.extractParams=function(search){var params={};return search.replace(/^\?/,"").replace(/([^=&]+)=([^&]*)/g,function(m,key,value){params[decodeURIComponent(key)]=decodeURIComponent(value)}),params},UrlParser.prototype.get=function(what){return!!_.contains(urlParts,what)&&this.data[what]},UrlParser.prototype.getParams=function(){return this.params},UrlParser.prototype.setParams=function(params){_.isObject(params)&&(this.params=params)},UrlParser.prototype.addParam=function(key,value){key&&(this.params[key]=value)},UrlParser.prototype.getPaths=function(){return this.data.pathname.replace(/^\/|\/$/g,"").split("/")},UrlParser.prototype.getUrl=function(exclude){var url="";return exclude=exclude||[],this.data&&(this.data.hostname&&!_.contains(exclude,"host")&&(url+=(this.data.protocol?this.data.protocol:"http:")+"//"+this.data.hostname.replace(/\/$/,""),this.data.port&&80!==this.data.port&&"80"!==this.data.port&&"0"!==this.data.port&&(url+=":"+this.data.port)),!/\/$/.test(url)&&!/^\//.test(this.data.pathname)&&(url+="/"),url+=this.data.pathname,this.params&&!_.contains(exclude,"params")&&(url+="?",_.forEach(this.params,function(value,key){url+=encodeURIComponent(key)+"="+encodeURIComponent(value)+"&"}),url=url.substring(0,url.length-1)),this.data.hash&&!_.contains(exclude,"hash")&&(url+=this.data.hash)),url},UrlParser.prototype.getBaseUrl=function(){var baseUrl=this.getUrl(["params","hash"]),paths=this.getPaths(),lastPart=paths[paths.length-1];return 0<paths.length&&/\.[a-z]+$/.test(lastPart)&&(baseUrl=baseUrl.replace(lastPart,"").replace(/\/\/$/,"/")),baseUrl},UrlParser.prototype.sameDomain=function(url){var parsedUrl;if("undefined"==typeof url&&(parsedUrl=new UrlParser(window.location)),"string"==typeof url&&(parsedUrl=new UrlParser(url)),url instanceof UrlParser&&(parsedUrl=url),!(parsedUrl instanceof UrlParser))throw new TypeError("Invalid url format");return"data:"===this.get("protocol")||"data:"===parsedUrl.get("protocol")||this.get("protocol")===parsedUrl.get("protocol")&&this.get("hostname")===parsedUrl.get("hostname")&&this.get("port")===parsedUrl.get("port")},UrlParser.prototype.checkCORS=UrlParser.prototype.sameDomain,UrlParser}),define("taoOutcomeUi/controller/viewResult",["module","jquery","i18n","util/url","layout/section","taoItems/previewer/factory","jquery.fileDownload"],function(module,$,__,urlHelper,section,previewerFactory){'use strict';return{start:function start(){var conf=module.config(),$container=$("#view-result"),$resultFilterField=$(".result-filter",$container),$classFilterField=$("[name=\"class-filter\"]",$container),classFilter=JSON.parse(conf.filterTypes)||[];for(var i in $resultFilterField.select2({minimumResultsForSearch:-1}).select2("val",conf.filterSubmission||"all"),classFilter)$("[value=\"".concat(classFilter[i],"\"]")).prop("checked","checked");$(".result-filter-btn",$container).click(function(){classFilter=[""],$classFilterField.each(function(){$(this).prop("checked")&&classFilter.push($(this).val())}),section.loadContentBlock(urlHelper.route("viewResult","Results","taoOutcomeUi"),{id:conf.id,classUri:conf.classUri,filterSubmission:$resultFilterField.select2("val"),filterTypes:classFilter})}),$(".download",$container).on("click",function(){var variableUri=$(this).val();$.fileDownload(urlHelper.route("getFile","Results","taoOutcomeUi"),{preparingMessageHtml:__("We are preparing your report, please wait..."),failMessageHtml:__("There was a problem generating your report, please try again."),httpMethod:"POST",data:{variableUri:variableUri,deliveryUri:conf.classUri}})}),$(".preview",$container).on("click",function(e){var $this=$(this),deliveryId=$this.data("deliveryId"),resultId=$this.data("resultId"),itemDefinition=$this.data("definition"),uri=$this.data("uri"),type=$this.data("type"),state=$this.data("state");e.preventDefault(),deliveryId&&resultId&&itemDefinition&&(uri={uri:uri,resultId:resultId,itemDefinition:itemDefinition,deliveryUri:deliveryId}),previewerFactory(type,uri,state,{readOnly:!0,fullPage:!0})})}}}),define("taoOutcomeUi/loader/taoOutcomeUi.bundle",function(){}),define("taoOutcomeUi/loader/taoOutcomeUi.min",["taoItems/loader/taoItems.min"],function(){});
//# sourceMappingURL=taoOutcomeUi.min.js.map